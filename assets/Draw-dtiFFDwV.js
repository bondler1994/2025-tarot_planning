import{_ as X,r as o,a as $,S as A,q as T,v as e,aa as _,L as r,F as G,O,y as p,D as i,t as U,R as y,x as q,C as H,G as P,A as w}from"./index-CSCzfQmP.js";import{t as Q}from"./tarotDiaryAPI-BLKX_40E.js";import{u as W}from"./cardDataStore-CObwyrdX.js";import"./index-DW_MHI2K.js";const j={class:"draw-background"},J=["onClick"],K=78,Z={__name:"Draw",setup(tt){const u=o({}),S=W();(async()=>{u.value=await Q.GET("/api/tarot-draw"),S.setCardData(u.value.tarot_card)})();const R=$(()=>{var t;return(t=u.value.tarot_card)!=null&&t.is_upright?"正位":"逆位"}),B=P(),v=o([]),E=t=>t?"none":"";let c=o(!1),f=!1,b,k,g=!1;const x=t=>{f=!0,b=t.pageX-t.currentTarget.offsetLeft,k=t.currentTarget.scrollLeft},m=()=>{f=!1,setTimeout(()=>{g=!1},50)},h=o(null),F=t=>{if(!f)return;g=!0;const n=t.pageX-t.currentTarget.offsetLeft-b;if(t.currentTarget.scrollLeft=k-n,t.touches&&a.value===3){const d=t.targetTouches[0].pageY/window.outerHeight,l=parseInt(78*d);h.value=l}},L=o(!1),I=async t=>{if(g)return;const s=v.value.find(n=>n.id===t);s.isChosen=!0,s.isFlip=!s.isFlip,L.value=!0,h.value=null,setTimeout(()=>{c.value=!0},3e3)};A(()=>{for(let t=0;t<K;t++)v.value.push({id:t,isFlip:!1,isChosen:!1})});const Y=t=>a.value===1?"rotate(80deg) translateY(-2000px)":a.value>=2?`rotate(${80+20/78*t}deg) translateY(-2000px)`:"rotate(80deg) translateY(-2000px)";let a=o(0);const z=()=>{a.value=a.value+1,setTimeout(()=>{a.value=a.value+1},1e3),setTimeout(()=>{a.value=a.value+1},2500)},N=t=>{if(a.value>=2)return`transform ${1.5/78*t}s ease-out, scale 1s linear, translate 1s linear, opacity 0.5s linear`},D=o(!1),V=()=>{D.value=!0,setTimeout(()=>{B.push({name:"WriteDiary"})},2e3)};return(t,s)=>{var n,d;return w(),T("main",j,[e("div",{class:p(["cards",{"card-hide":r(c)}]),onMousedown:x,onTouchstart:x,onMouseleave:m,onTouchend:m,onMouseup:m,onMousemove:F,onTouchmove:F},[e("div",{class:"screen",onClickOnce:z,style:_({display:r(a)<3?"inline-block":"none"})},null,36),e("div",null,[(w(!0),T(G,null,O(v.value,(l,C)=>{var M;return w(),T("div",{key:l.id,class:p(["card-container",{step1:r(a)===0,step2:r(a)===1,step3:r(a)>=2,show:l.isFlip}]),style:_({pointerEvents:E(L.value),transform:r(a)>=2&&!l.isFlip?Y(C):"",transition:l.isFlip?"":N(C)}),onClick:at=>I(l.id)},[e("div",{class:p(["card",{"hover-effect":h.value===C,flip:l.isFlip}])},[e("div",{class:p(["front",{reversed:!((M=u.value.tarot_card)!=null&&M.is_upright)}])},null,2),s[0]||(s[0]=e("div",{class:"back"},null,-1))],2)],14,J)}),128))])],34),e("h3",{class:p(["draw-hint",{"card-hide":r(c)}])},s[1]||(s[1]=[i(" 請"),e("br",null,null,-1),i("點"),e("br",null,null,-1),i("擊"),e("br",null,null,-1),i("抽"),e("br",null,null,-1),i("牌"),e("br",null,null,-1),i("！ ")]),2),e("div",{class:"tarot-hint",style:_({zIndex:r(c)?"1":"-1",opacity:r(c)&&!D.value?"1":"0",transition:D.value?"opacity 1s ease":""})},[e("h4",null,y((n=u.value.tarot_card)==null?void 0:n.name)+" - "+y(R.value),1),s[3]||(s[3]=e("div",{class:"hint-card"},null,-1)),e("p",null,y((d=u.value.tarot_card)==null?void 0:d.blessing_message),1),U(H,{onClick:V,class:"write-diary-btn"},{default:q(()=>s[2]||(s[2]=[i("撰寫日記")])),_:1})],4)])}}},ot=X(Z,[["__scopeId","data-v-56880b4c"]]);export{ot as default};
