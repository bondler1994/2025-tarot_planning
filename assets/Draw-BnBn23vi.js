import{Q as V}from"./QBtn-Cn4OntbK.js";import{r as l,f as $,k as A,x as T,y as e,ad as _,C as r,S as G,X as Q,R as p,F as i,z as U,G as y,A as H,D as O,E as w}from"./index-DgLSNGBl.js";import{t as P}from"./tarotDiaryAPI-BLKX_40E.js";import{u as W}from"./cardDataStore-C25tBJKq.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DW_MHI2K.js";const q={class:"draw-background"},J=["onClick"],K=78,Z={__name:"Draw",setup(tt){const u=l({}),S=W();(async()=>{u.value=await P.GET("/api/tarot-draw"),S.setCardData(u.value.tarot_card)})();const E=$(()=>{var t;return(t=u.value.tarot_card)!=null&&t.is_upright?"正位":"逆位"}),R=O(),v=l([]),z=t=>t?"none":"";let c=l(!1),f=!1,k,b,g=!1;const x=t=>{f=!0,k=t.pageX-t.currentTarget.offsetLeft,b=t.currentTarget.scrollLeft},m=()=>{f=!1,setTimeout(()=>{g=!1},50)},h=l(null),F=t=>{if(!f)return;g=!0;const n=t.pageX-t.currentTarget.offsetLeft-k;if(t.currentTarget.scrollLeft=b-n,t.touches&&a.value===3){const d=t.targetTouches[0].pageY/window.outerHeight,o=parseInt(78*d);h.value=o}},M=l(!1),B=async t=>{if(g)return;const s=v.value.find(n=>n.id===t);s.isChosen=!0,s.isFlip=!s.isFlip,M.value=!0,h.value=null,setTimeout(()=>{c.value=!0},3e3)};A(()=>{for(let t=0;t<K;t++)v.value.push({id:t,isFlip:!1,isChosen:!1})});const I=t=>a.value===1?"rotate(80deg) translateY(-2000px)":a.value>=2?`rotate(${80+20/78*t}deg) translateY(-2000px)`:"rotate(80deg) translateY(-2000px)";let a=l(0);const X=()=>{a.value=a.value+1,setTimeout(()=>{a.value=a.value+1},1e3),setTimeout(()=>{a.value=a.value+1},2500)},Y=t=>{if(a.value>=2)return`transform ${1.5/78*t}s ease-out, scale 1s linear, translate 1s linear, opacity 0.5s linear`},D=l(!1),N=()=>{D.value=!0,setTimeout(()=>{R.push({name:"WriteDiary"})},2e3)};return(t,s)=>{var n,d;return w(),T("main",q,[e("div",{class:p(["cards",{"card-hide":r(c)}]),onMousedown:x,onTouchstart:x,onMouseleave:m,onTouchend:m,onMouseup:m,onMousemove:F,onTouchmove:F},[e("div",{class:"screen",onClickOnce:X,style:_({display:r(a)<3?"inline-block":"none"})},null,36),e("div",null,[(w(!0),T(G,null,Q(v.value,(o,C)=>{var L;return w(),T("div",{key:o.id,class:p(["card-container",{step1:r(a)===0,step2:r(a)===1,step3:r(a)>=2,show:o.isFlip}]),style:_({pointerEvents:z(M.value),transform:r(a)>=2&&!o.isFlip?I(C):"",transition:o.isFlip?"":Y(C)}),onClick:at=>B(o.id)},[e("div",{class:p(["card",{"hover-effect":h.value===C,flip:o.isFlip}])},[e("div",{class:p(["front",{reversed:!((L=u.value.tarot_card)!=null&&L.is_upright)}])},null,2),s[0]||(s[0]=e("div",{class:"back"},null,-1))],2)],14,J)}),128))])],34),e("h3",{class:p(["draw-hint",{"card-hide":r(c)}])},s[1]||(s[1]=[i(" 請"),e("br",null,null,-1),i("點"),e("br",null,null,-1),i("擊"),e("br",null,null,-1),i("抽"),e("br",null,null,-1),i("牌"),e("br",null,null,-1),i("！ ")]),2),e("div",{class:"tarot-hint",style:_({zIndex:r(c)?"1":"-1",opacity:r(c)&&!D.value?"1":"0",transition:D.value?"opacity 1s ease":""})},[e("h4",null,y((n=u.value.tarot_card)==null?void 0:n.name)+" - "+y(E.value),1),s[3]||(s[3]=e("div",{class:"hint-card"},null,-1)),e("p",null,y((d=u.value.tarot_card)==null?void 0:d.blessing_message),1),U(V,{onClick:N,class:"write-diary-btn"},{default:H(()=>s[2]||(s[2]=[i("撰寫日記")])),_:1})],4)])}}},ut=j(Z,[["__scopeId","data-v-56880b4c"]]);export{ut as default};
