import{_ as R,r as d,a as U,q as S,v as n,t as a,x as r,G as j,A as p,B as g,T as C,L as u,E as w,M as _,C as c,H as h,I as Q}from"./index-CSCzfQmP.js";import{e as q,p as z,a as E,r as V,I as H,Q as N,b as A}from"./InputBoxRadio-6olGMi6E.js";import{Q as O,I as m}from"./InputBox-CDQMk2Iv.js";import{Q as T}from"./QInput-C29NEW-e.js";import{C as F}from"./ClosePopup-C4A8Sqpv.js";import{u as G}from"./profileStore-CaRdUoLh.js";import{t as L}from"./tarotDiaryAPI-BLKX_40E.js";import"./index-DW_MHI2K.js";const M={class:"profile column content-center"},J={class:"profile__form"},K={class:"row items-center justify-end"},W={key:1,class:"button-group row justify-center"},X={__name:"ProfileView",setup(Y){j();const o=G(),s=d({name:o.profile.name,password:o.profile.password,gender:o.profile.gender,birthdate:o.profile.birthdate}),y=d(""),t=d({email:!0,name:!0,password:!0,gender:!0,birthdate:!0}),P=d([{label:"男",value:"male"},{label:"女",value:"female"},{label:"其他",value:"other"}]),v=U({get(){return s.value.birthdate.split("-").join("/")},set(i){s.value.birthdate=i.split("/").join("-")}}),k=U(()=>Object.values(t.value).some(i=>i===!1)),f=d(!1),b=d(!1);function x(){b.value=!0}async function B(){console.log(s.value);const i=s.value;try{const e=await L.PUT("/api/auth/update",i);console.log(e),o.updateProfile(i),f.value=!0,x()}catch(e){console.log(e),f.value=!1,x()}}function I(){t.value={email:!0,name:!0,password:!0,gender:!0,birthdate:!0}}function D(){s.value={name:o.profile.name,password:o.profile.password,gender:o.profile.gender,birthdate:o.profile.birthdate},t.value={email:!0,name:!0,password:!0,gender:!0,birthdate:!0}}return(i,e)=>(p(),S("div",M,[e[14]||(e[14]=n("div",{class:"profile__title"},[n("div",{class:"title"},"會員資料")],-1)),n("div",J,[a(O,{class:"form",onSubmit:B},{default:r(()=>[a(m,{title:"帳號",hasSign:!1,modelValue:u(o).profile.email,"onUpdate:modelValue":e[0]||(e[0]=l=>u(o).profile.email=l),rules:[u(q)],disable:t.value.email},null,8,["modelValue","rules","disable"]),a(m,{title:"密碼",type:"password",hasSign:!0,sign:"edit",disable:t.value.password,"onUpdate:disable":e[1]||(e[1]=l=>t.value.password=l),modelValue:s.value.password,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.password=l),rules:[u(z)]},null,8,["disable","modelValue","rules"]),t.value.password?C("",!0):(p(),g(m,{key:0,type:"password",hasSign:!0,sign:"edit",modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=l=>y.value=l),rules:[l=>u(E)(l,s.value.password)]},null,8,["modelValue","rules"])),a(m,{title:"暱稱",hasSign:!0,sign:"edit",disable:t.value.name,"onUpdate:disable":e[4]||(e[4]=l=>t.value.name=l),modelValue:s.value.name,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.name=l),rules:[u(V)]},null,8,["disable","modelValue","rules"]),a(H,{title:"性別",hasSign:!0,sign:"edit",modelValue:s.value.gender,"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.gender=l),rules:[u(V)],options:P.value,disable:t.value.gender,"onUpdate:disable":e[7]||(e[7]=l=>t.value.gender=l)},null,8,["modelValue","rules","options","disable"]),a(m,{title:"生日",hasSign:!0,sign:"edit",modelValue:v.value,"onUpdate:modelValue":e[9]||(e[9]=l=>v.value=l),rules:[u(V)],disable:t.value.birthdate,"onUpdate:disable":e[10]||(e[10]=l=>t.value.birthdate=l)},{default:r(()=>[a(w,{name:"event",class:"cursor-pointer",size:"20px"},{default:r(()=>[a(N,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:r(()=>[a(A,{modelValue:v.value,"onUpdate:modelValue":e[8]||(e[8]=l=>v.value=l)},{default:r(()=>[n("div",K,[_(a(c,{label:"確定",color:"primary",flat:""},null,512),[[F]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules","disable"]),k.value?(p(),S("div",W,[a(c,{class:"button",label:"取消",color:"grey-2",unelevated:"",onClick:D}),a(c,{class:"button",label:"確認",type:"submit",color:"grey-7",unelevated:""})])):C("",!0)]),_:1})]),a(T,{modelValue:b.value,"onUpdate:modelValue":e[11]||(e[11]=l=>b.value=l),position:"top",onHide:I},{default:r(()=>[a(h,{style:{width:"350px"}},{default:r(()=>[f.value?(p(),g(Q,{key:0,class:"row items-center no-wrap"},{default:r(()=>[a(w,{class:"q-pr-xs",name:"check_circle",size:"sm",color:"positive"}),e[12]||(e[12]=n("div",{class:"text-weight-bold"},"更新成功",-1))]),_:1})):(p(),g(Q,{key:1,class:"row items-center no-wrap"},{default:r(()=>[a(w,{class:"q-pr-xs",name:"error",size:"sm",color:"negative"}),e[13]||(e[13]=n("div",{class:"text-weight-bold"},"連線失敗",-1))]),_:1}))]),_:1})]),_:1},8,["modelValue"])]))}},re=R(X,[["__scopeId","data-v-2b4cc51c"]]);export{re as default};
