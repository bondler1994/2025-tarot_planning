import{a as I,Q as T}from"./QInput-C29NEW-e.js";import{c as z,h as R,_ as q,r as _,a as p,S as M,q as i,v as e,R as u,F as O,O as W,B as Y,T as f,t as r,C as S,x as b,z as j,U as A,A as n,H as N,I as Z,E as D}from"./index-CSCzfQmP.js";import{h as H}from"./html2canvas.esm-DyqYn1B1.js";import{a as J}from"./index-DW_MHI2K.js";const P=z({name:"QSpace",setup(){const w=R("div",{class:"q-space"});return()=>w}}),G={class:"container"},K={class:"header date"},X={class:"date__header"},ee={class:"date__body"},te={class:"date__footer"},ae={class:"body diary"},oe={class:"diary__body log"},se={class:"log__header card"},re={class:"interpretation__title"},ne={class:"interpretation__body"},le={class:"log__body"},ie={key:1,class:"log__text"},ce={class:"diary__footer icon"},de={key:0,class:"icon__header"},_e={class:"icon__body"},ue={class:"icon__footer"},ve={key:1,class:"edit-actions"},pe={class:"footer backward"},ge={class:"backward__header"},me={__name:"DiaryZoneView",setup(w){const g=_(new Date),$=p(()=>g.value.getFullYear()),k=p(()=>{const a={month:"2-digit",day:"2-digit"};return g.value.toLocaleDateString("zh-TW",a).split("/")}),V=p(()=>{const a={weekday:"short"};return g.value.toLocaleDateString("zh-TW",a)[1]});p(()=>g.value.toISOString().split("T"));const c=_([]),B=async()=>{try{const a=await J.get("https://my-json-server.typicode.com/bondler1994/2024-Web-Camp---JStest/db");c.value=await a.data.entries.filter(t=>t.created_at==="2024-03-07")}catch(a){console.error("獲取資料失敗",a),alert("無法載入")}};M(async()=>{await B()});const E=p(()=>c.value[0].tarot_card.is_upright==="true"?"正位":"逆位"),l=_(!1),v=_(""),Q=()=>(l.value=!0,v.value===c.value[0].user_entry_text),L=()=>(l.value=!1,v.value===c.value[0].user_entry_text),U=async()=>{try{c.value[0].user_entry_text=v.value,l.value=!1,m.value=!0,setTimeout(()=>{m.value=!1},2e3)}catch(a){console.error("儲存失敗",a),alert("無法儲存")}},m=_(!1),x=_(!1),F=async()=>{x.value=!0,await A();const a=document.querySelector(".diary__body");if(a){const t=await H(a),y=await new Promise(h=>t.toBlob(h,"image/png")),s=new Date,o=new File([y],`${s.getFullYear()}-${s.getMonth()+1}-${s.getDate()}.png`,{type:"image/png"});if(!/Mobi|Android/i.test(navigator.userAgent)){const h=URL.createObjectURL(y),d=document.createElement("a");d.href=h,d.download=`${s.getFullYear()}-${s.getMonth()+1}-${s.getDate()}_tarot`,d.style.display="none",document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(h)}else navigator.canShare&&navigator.canShare({files:[o]})?(await navigator.share({title:"今日塔羅",text:"來看看我今天抽到了什麼吧！",files:[o]}),console.log("分享成功！")):console.error("不支援分享此類型的內容")}else console.error(".diary__body 元素未找到");x.value=!1};return(a,t)=>{var s;const y=j("router-link");return n(),i("div",G,[e("div",K,[e("div",X,u(`${$.value}年`),1),e("div",ee,u(`${k.value[0]} 月 ${k.value[1]} 日`),1),e("div",te,u(`(${V.value})`),1)]),e("div",ae,[e("div",oe,[e("div",se,[t[2]||(t[2]=e("div",{class:"card__header"},null,-1)),(n(!0),i(O,null,W(c.value,(o,C)=>(n(),i("div",{class:"card__body interpretation",key:o.id||C},[e("span",re,u(`${o.tarot_card.name} - ${E.value}`),1),e("div",ne,u(o.tarot_card.blessing_message),1)]))),128))]),e("div",le,[l.value?(n(),Y(I,{key:0,modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=o=>v.value=o),class:"textarea","input-class":"white__text fixed-height",type:"textarea",maxlength:"300",color:"white",borderless:"","bg-color":"transparent",resize:"none",autogrow:"",rows:1,placeholder:"輸入今日心情",dense:!0},null,8,["modelValue"])):(n(),i("p",ie,u((s=c.value[0])==null?void 0:s.user_entry_text),1))])]),e("div",ce,[l.value?f("",!0):(n(),i("div",de)),e("div",_e,[l.value?f("",!0):(n(),i("img",{key:0,onClick:F,src:"/shareButton.png",alt:"shareButton"}))]),e("div",ue,[l.value?f("",!0):(n(),i("img",{key:0,onClick:Q,src:"/pen.png",alt:"pen"}))]),l.value?(n(),i("div",ve,[r(S,{label:"取消",unelevated:"",rounded:"",onClick:L,color:"grey"}),r(S,{label:"儲存",unelevated:"",rounded:"",onClick:U,color:"primary"})])):f("",!0),r(T,{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=o=>m.value=o),position:"top"},{default:b(()=>[r(N,{style:{width:"350px"}},{default:b(()=>[r(Z,{class:"row items-center no-wrap"},{default:b(()=>[e("div",null,[r(D,{class:"q-pr-xs",name:"check_circle",size:"sm",color:"positive"})]),r(P),t[3]||(t[3]=e("div",{class:"text-weight-bold"},"更新成功",-1))]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),e("div",pe,[r(y,{to:"/member/diary/overview",class:"backward__link"},{default:b(()=>[e("div",ge,[r(D,{name:"fa-solid fa-arrow-left"})]),t[4]||(t[4]=e("div",{class:"backward__body"},[e("span",null,"月曆一覽")],-1))]),_:1})])])}}},we=q(me,[["__scopeId","data-v-06e2b109"]]);export{we as default};
