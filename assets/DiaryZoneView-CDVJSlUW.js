import{a as F,Q as I}from"./QInput-BRdHTmQs.js";import{Q as S,b as D}from"./QBtn-BzKmpOb8.js";import{j as T,h as j,r as _,f as p,k as M,x as i,y as e,G as u,S as R,X as W,B as Y,Z as f,z as r,A as b,U as q,v as A,E as n}from"./index-D_uQiqUE.js";import{Q as N,a as O}from"./QCard-CWjqWXv8.js";import{h as Z}from"./html2canvas.esm-DyqYn1B1.js";import{a as G}from"./index-DW_MHI2K.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-timeout-wdgeJOu5.js";import"./use-dark-H87n5xvM.js";const P=T({name:"QSpace",setup(){const k=j("div",{class:"q-space"});return()=>k}}),X={class:"container"},H={class:"header date"},K={class:"date__header"},ee={class:"date__body"},te={class:"date__footer"},ae={class:"body diary"},oe={class:"diary__body log"},se={class:"log__header card"},re={class:"interpretation__title"},ne={class:"interpretation__body"},le={class:"log__body"},ie={key:1,class:"log__text"},ce={class:"diary__footer icon"},de={key:0,class:"icon__header"},_e={class:"icon__body"},ue={class:"icon__footer"},ve={key:1,class:"edit-actions"},pe={class:"footer backward"},me={class:"backward__header"},ge={__name:"DiaryZoneView",setup(k){const m=_(new Date),$=p(()=>m.value.getFullYear()),w=p(()=>{const a={month:"2-digit",day:"2-digit"};return m.value.toLocaleDateString("zh-TW",a).split("/")}),Q=p(()=>{const a={weekday:"short"};return m.value.toLocaleDateString("zh-TW",a)[1]});p(()=>m.value.toISOString().split("T"));const c=_([]),V=async()=>{try{const a=await G.get("https://my-json-server.typicode.com/bondler1994/2024-Web-Camp---JStest/db");c.value=await a.data.entries.filter(t=>t.created_at==="2024-03-07")}catch(a){console.error("獲取資料失敗",a),alert("無法載入")}};M(async()=>{await V()});const B=p(()=>c.value[0].tarot_card.is_upright==="true"?"正位":"逆位"),l=_(!1),v=_(""),E=()=>(l.value=!0,v.value===c.value[0].user_entry_text),L=()=>(l.value=!1,v.value===c.value[0].user_entry_text),U=async()=>{try{c.value[0].user_entry_text=v.value,l.value=!1,g.value=!0,setTimeout(()=>{g.value=!1},2e3)}catch(a){console.error("儲存失敗",a),alert("無法儲存")}},g=_(!1),x=_(!1),z=async()=>{x.value=!0,await A();const a=document.querySelector(".diary__body");if(a){const t=await Z(a),y=await new Promise(h=>t.toBlob(h,"image/png")),s=new Date,o=new File([y],`${s.getFullYear()}-${s.getMonth()+1}-${s.getDate()}.png`,{type:"image/png"});if(!/Mobi|Android/i.test(navigator.userAgent)){const h=URL.createObjectURL(y),d=document.createElement("a");d.href=h,d.download=`${s.getFullYear()}-${s.getMonth()+1}-${s.getDate()}_tarot`,d.style.display="none",document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(h)}else navigator.canShare&&navigator.canShare({files:[o]})?(await navigator.share({title:"今日塔羅",text:"來看看我今天抽到了什麼吧！",files:[o]}),console.log("分享成功！")):console.error("不支援分享此類型的內容")}else console.error(".diary__body 元素未找到");x.value=!1};return(a,t)=>{var s;const y=q("router-link");return n(),i("div",X,[e("div",H,[e("div",K,u(`${$.value}年`),1),e("div",ee,u(`${w.value[0]} 月 ${w.value[1]} 日`),1),e("div",te,u(`(${Q.value})`),1)]),e("div",ae,[e("div",oe,[e("div",se,[t[2]||(t[2]=e("div",{class:"card__header"},null,-1)),(n(!0),i(R,null,W(c.value,(o,C)=>(n(),i("div",{class:"card__body interpretation",key:o.id||C},[e("span",re,u(`${o.tarot_card.name} - ${B.value}`),1),e("div",ne,u(o.tarot_card.blessing_message),1)]))),128))]),e("div",le,[l.value?(n(),Y(F,{key:0,modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=o=>v.value=o),class:"textarea","input-class":"white__text fixed-height",type:"textarea",maxlength:"300",color:"white",borderless:"","bg-color":"transparent",resize:"none",autogrow:"",rows:1,placeholder:"輸入今日心情",dense:!0},null,8,["modelValue"])):(n(),i("p",ie,u((s=c.value[0])==null?void 0:s.user_entry_text),1))])]),e("div",ce,[l.value?f("",!0):(n(),i("div",de)),e("div",_e,[l.value?f("",!0):(n(),i("img",{key:0,onClick:z,src:"/shareButton.png",alt:"shareButton"}))]),e("div",ue,[l.value?f("",!0):(n(),i("img",{key:0,onClick:E,src:"/pen.png",alt:"pen"}))]),l.value?(n(),i("div",ve,[r(S,{label:"取消",unelevated:"",rounded:"",onClick:L,color:"grey"}),r(S,{label:"儲存",unelevated:"",rounded:"",onClick:U,color:"primary"})])):f("",!0),r(I,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=o=>g.value=o),position:"top"},{default:b(()=>[r(N,{style:{width:"350px"}},{default:b(()=>[r(O,{class:"row items-center no-wrap"},{default:b(()=>[e("div",null,[r(D,{class:"q-pr-xs",name:"check_circle",size:"sm",color:"positive"})]),r(P),t[3]||(t[3]=e("div",{class:"text-weight-bold"},"更新成功",-1))]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),e("div",pe,[r(y,{to:"/member/diary/overview",class:"backward__link"},{default:b(()=>[e("div",me,[r(D,{name:"fa-solid fa-arrow-left"})]),t[4]||(t[4]=e("div",{class:"backward__body"},[e("span",null,"月曆一覽")],-1))]),_:1})])])}}},De=J(ge,[["__scopeId","data-v-06e2b109"]]);export{De as default};
